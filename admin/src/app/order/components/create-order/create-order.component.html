<div class="container">
  <mat-toolbar color="primary">
    <mat-toolbar-row>
      <a mat-icon-button routerLink="/product">
        <mat-icon aria-hidden="false" aria-label="Example heart icon">arrow_back</mat-icon>
      </a>
      <span>Create Order</span>
      <span class="example-spacer"></span>
      <button mat-button (click)="onProductAdd(addProductForm.value)">
        Add
      </button>
      <!-- <button mat-button routerLink="/order">Cancel</button> -->
    </mat-toolbar-row>
  </mat-toolbar>
  <div class="main-div">
    <app-loader [isLoading]="isLoading" size="1"></app-loader>
    <form class="example-form" [formGroup]="addProductForm">
      <button *ngIf="t.controls.length === 0" mat-icon-button (click)="addMoreItemDetails(t.controls)">
        Add Item
      </button>

      <div *ngFor="let detail of t.controls; let i = index">
        <div fxLayout="row" [formGroup]="detail" fxLayout.xs="column" fxLayoutAlign="start start" fxLayoutGap="12px">
          <mat-form-field class="example-full-width" fxFlex="16%" fxFlexFill>
            <mat-label>Name</mat-label>
            <input
              [matAutocomplete]="auto"
              (input)="onInputChange($event.target.value, i, detail)"
              formControlName="name"
              name="name"
              matInput
              placeholder="Name"
            />
            <mat-error *ngIf="detail.controls.name.errors">
              <div *ngIf="detail.controls.name.errors.required">Name is required</div>
            </mat-error>
            <mat-progress-bar
              style="top: 5px;"
              *ngIf="detail.controls.name.value && detail.controls.name.value.length > 2"
              mode="indeterminate"
            ></mat-progress-bar>
          </mat-form-field>

          <mat-autocomplete
            #auto="matAutocomplete"
            [displayWith]="displayFn"
            (optionSelected)="setQwtAndPrice($event.option.value, detail)"
          >
            <mat-option *ngFor="let option of options[i]" [value]="option">
              {{ option.name }}
            </mat-option>
          </mat-autocomplete>

          <mat-form-field class="example-full-width" fxFlex="12%" fxFlexFill>
            <mat-label>Quantity</mat-label>
            <input
              formControlName="qwt"
              name="qwt"
              (input)="onQwtChange($event.target.value, detail, i)"
              matInput
              placeholder="Quantity"
            />
            <mat-error *ngIf="detail.controls.qwt.errors">
              <div *ngIf="detail.controls.qwt.errors.required">Quantity is required</div>
            </mat-error>
          </mat-form-field>

          <mat-form-field class="example-full-width" fxFlex="12%" fxFlexFill>
            <mat-label>Unit Price</mat-label>
            <input
              formControlName="price"
              name="price"
              [value]="detail.controls.name.value.price || 0"
              matInput
              placeholder="Price"
            />
            <mat-error *ngIf="detail.controls.price.errors">
              <div *ngIf="detail.controls.price.errors.required">Price is required</div>
            </mat-error>
          </mat-form-field>

          <mat-form-field class="example-full-width" fxFlex="12%" fxFlexFill>
            <mat-label>Total</mat-label>
            <input
              formControlName="total"
              name="total"
              (input)="calculateTotal($event.target.value, detail.controls)"
              matInput
              placeholder="Total"
            />
            <mat-error *ngIf="detail.controls.total.errors">
              <div *ngIf="detail.controls.total.errors.required">Total is required</div>
            </mat-error>
          </mat-form-field>

          <div fxFlex="10%">
            <button style="line-height: 6;" mat-icon-button (click)="removeItemDetils(i, t.controls[i])">
              <mat-icon aria-hidden="false" aria-label="Remove">delete</mat-icon>
            </button>
            <button
              color="primary"
              *ngIf="t.controls.length === i + 1"
              style="line-height: 6;"
              mat-icon-button
              fxFlex
              (click)="addMoreDetails(i, t.controls)"
            >
              <mat-icon aria-hidden="false" aria-label="add">add_box</mat-icon>
            </button>
          </div>
        </div>
      </div>
      <div>
        <mat-toolbar class="items-footer"> Total: {{ grandTotal }} | Items: {{ t.controls.length }} </mat-toolbar>
      </div>
    </form>
  </div>
</div>
